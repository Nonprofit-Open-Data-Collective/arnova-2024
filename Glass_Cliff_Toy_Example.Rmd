---
title: "Glass Cliff Toy Example"
author: "Tiana Marrese"
date: "2024-11-19"
output: html_document
---



# Nonprofits and the Glass Cliff
## A Research Exploration

This script will present several new components of the Nonprofit Open Data Collective through a toy example investigating the "Glass Cliff phenomenon" or the idea the women are more likely to be appointed to precarious positions of power relative to their male counterparts. We will specifically highlight the integrated data environment and the numerous resources available for research on the third sector. 


### Important Resources

[Data Catalog](https://nccs.urban.org/nccs/catalogs/catalog-efile.html)
\
[Data Dictionary](https://nonprofit-open-data-collective.github.io/irs990efile/data-dictionary/data-dictionary.html)
\
[Open Data Collective Landing Page](https://nonprofit-open-data-collective.github.io/tools/)

\


```{r setup, results='hide', message = F}


#devtools::install_github( "Nonprofit-Open-Data-Collective/peopleparser" )
#devtools::install_github( 'nonprofit-open-data-collective/titleclassifier' )
#devtools::install_github('nonprofit-open-data-collective/fiscal')

library(dplyr)
library(utils)
library(peopleparser)
library(titleclassifier)
library( fiscal )
library(tidyr)
library(RecordLinkage)
library(stringr)
library(reshape2)
library(ggplot2)
library(ggrepel)

#Change working directory to personal path
setwd("~/Tiana_School_Work/PhD/Dissertation/Glass_Cliff_Paper")

```






### Getting Main Data

Processed IRS 990 Efile data are housed in the [data catalog](https://nccs.urban.org/nccs/catalogs/catalog-efile.html) with the respective [data dictionaries ](https://nonprofit-open-data-collective.github.io/irs990efile/data-dictionary/data-dictionary.html). You can find further information about sources, processing, and final parsing on these sites . 
\
\
For our toy example, we are particularly interested in the part of the 990 form that collects information about the board members in a nonprofit. This is known as Part VII data. We will begin by pulling two years of this data. 
\
\
There are two main ways to access the data. You can download the data locally to your computer from the data catalog and read it into your R environment or you can use pre-built functions to read it directly in R. We present examples of both below. 
\

```{r}

#Reading in locally store data
df2010 <- read.csv( "Coding/Data/PartVII/PartVII-2010.csv" )
df2011 <- read.csv( "Coding/Data/PartVII/PartVII-2011.csv" )



#Pre-built functions:
nodc <- "https://raw.githubusercontent.com/Nonprofit-Open-Data-Collective/"
repo <- "arnova-2024/refs/heads/main/"
file <- "functions.R"
source( paste0( nodc, repo, file ) )


df2010.fun <- get_partvii(2010)
df2011.fun <- get_partvii(2011)



```


\
\

### Preparing Main Data

The main variables of interest in these data are the board member names and their titles. We will create a data frame that contains both years of our data then we will utilize pre-built packages from the [Nonprofit Open Data Repositories](https://github.com/orgs/Nonprofit-Open-Data-Collective/repositories) to clean these variables further (the packages are `peopleparser` and `titleclassifier`). Eventually, pre-cleaned versions of the data will be available for download but for now we highlight the steps to utilize these packages directly. 
\

```{r, results = 'hide'}

#First, we want to combine the two years of data
#For simplicity, we will only work with the data pulled locally. 

#We need to:
#Remove "X" columns from the dfs that have this
#Also remove "average hours for related org (COMP_DTK_AVE_HOUR_WEEK_RL)" since this isn't present in all of them
#You could alternatively add a column of this variable to the dfs that don't have this, we don't this var so we will remove it

df2011 <- df2011 %>% select(-c( "X", "F9_07_COMP_DTK_AVE_HOUR_WEEK_RL"))

#Let's put them all together
df <- rbind(df2010, df2011)


#The packages to clean the name and title variables can take a bit to run. So before initiating them, we can make some assumptions about the observations we want. We are specifically interested in locating paid CEOs of NP. We will assume these positions must make more than $1 and work more than 15 hours

df_sub <- df %>% filter(!is.na(F9_07_COMP_DTK_COMP_ORG) &
                      F9_07_COMP_DTK_COMP_ORG > 1  &
                      !is.na(F9_07_COMP_DTK_AVE_HOUR_WEEK) &
                      F9_07_COMP_DTK_AVE_HOUR_WEEK > 15
                      )

#For simplicity and to limit run time, we will take a sample of 10 people from above and perform the functions provided by peopleparse and titleclassifier. You can comment out the next line if you would like to do the entire df (but be aware that it will take a bit of time to run)

df_sub <- df_sub[1:10,]
#write.csv(df_sub, "PARTVII_10employees_2009_2010.csv")

```


### Utilizing NP Open Data Collective Packages

The Nonprofit Open Data Collection provides tools in addition to dataframes that can be used to clean, process, and extend the data. We highlight two below. `peopleparser` provides name standarization and gender coding while `titleclassifier` standardized titles of the 990 form. Examples of their usage with a subset of 10 nonprofit employees from the Part VII 990 data are below.
\

#### PeopleParser

```{r, message = F}


df_sub <- read.csv(file = "PARTVII_10employees_2009_2010.csv")


####################################
#Peopleparser 
#https://github.com/Nonprofit-Open-Data-Collective/peopleparser
####################################

#Now let's use peopleparser to clean the names. This function can take a bit to run so let's further limit our df to only unique names
df_unique_names <- df_sub %>% select(F9_07_COMP_DTK_NAME_PERS) %>%
  distinct()


#Now doing people parser
df_names <- parse.names(df_unique_names$F9_07_COMP_DTK_NAME_PERS)

#We can left_join  these names back onto the df
df_sub <- df_sub %>% left_join(df_names, by = c("F9_07_COMP_DTK_NAME_PERS" = "name"))


#write.csv(df_sub, file = "PARTVII_10employees_2009_2010_names.csv")

```


#### TitleClassifier

```{r, message = F}

df_sub <- read.csv(file = "PARTVII_10employees_2009_2010_names.csv")

####################################
#Titleclassifier 
#https://github.com/Nonprofit-Open-Data-Collective/titleclassifier
####################################

#Since this function also takes a bit of time, we will narrow down the titles to their unique occurrences based on the vars input to the function
df_unique_titles <- df_sub %>% 
  distinct(F9_07_COMP_DTK_TITLE,
             FORMTYPE,
             F9_07_COMP_DTK_AVE_HOUR_WEEK,  
             F9_07_COMP_DTK_COMP_ORG, 
             F9_07_COMP_DTK_EMPL_BEN, 
             F9_07_COMP_DTK_COMP_RLTD, 
             F9_07_COMP_DTK_COMP_OTH,
             F9_07_COMP_DTK_POS_INDIV_TRUST_X, 
             F9_07_COMP_DTK_POS_INST_TRUST_X, 
             F9_07_COMP_DTK_POS_OFF_X, 
             F9_07_COMP_DTK_POS_KEY_EMPL_X, 
             F9_07_COMP_DTK_POS_HIGH_COMP_X, 
             F9_07_COMP_DTK_POS_FORMER_X,
             F9_07_COMP_DTK_NAME_PERS  , .keep_all = T)


#Running the title classifier now
df_titles <-  df_unique_titles %>% 
  standardize_df() %>% 
  remove_dates() %>% 
  standardize_conj() %>% 
  split_titles() %>% 
  standardize_spelling() %>% 
  gen_status_codes() %>% 
  standardize_titles() %>%
  categorize_titles()




#Note: the title classifier seems to only keep unique rows by a person's name, not each occurrence they have. So columns like hours worked and pay by individual are not completely correct. But the total info about the org should be fine to keep. Will need to eventually revisit assumptions made in the package


#now we join back to df_sub
#df_titles may have multiple rows for people that list "x/y" in their title
#So we want to do a full join where we keep all rows from both
df_sub_names_titles <- df_sub %>% full_join(df_titles, by = c("EIN"= "ein",
                                                     "F9_07_COMP_DTK_NAME_PERS" = "dtk.name",
                                                      "F9_07_COMP_DTK_TITLE" = "title.raw"),
                                            relationship = "many-to-many")


#write.csv(df_sub_names_titles, "PARTVII_10employees_2009_2010_names_titles.csv")

```



### Glass Cliff Analysis

There are several data cleaning and preparation steps that need to be performed on the base data before our analysis. These are beyond the scope of this toy example. Instead, we provide a cleaned subset of the data. We provide two dataframes of 1000 and 10 unique nonprofits that experienced at least one CEO transition between 2009 and 2019. It should be noted that it is possible for these organizations to experience more than one transition during this time frame. As such, we have a total of 1067 transitions. We can analyze various facets of these transitions. 
\

```{r}

ceo_trans_10    <- read.csv("toy_CEO_trans_10EIN.csv" )
ceo_trans_1000 <- read.csv("toy_CEO_trans_1000EIN.csv")

```


#### Financial Data Joining
The first thing we want to do with these data are to add financial information about the orgs during each respective year. We can again pull this info from the open data collective. This step takes about 10 minutes to run so we will comment out the lines and run similar steps with the data of 10 nonprofits and pre-subset financial dataframes.
\

```{r, results = 'hide'}


summary <- read.csv("F9-P01-T00-SUMMARY-SAMPLE-10.csv")
revenue <- read.csv("F9-P08-T00-REVENUE-SAMPLE-10.csv")
expenses <- read.csv("F9-P09-T00-EXPENSES-SAMPLE-10.csv")


#let's join everything together:

ceo_trans_10_fncl <- ceo_trans_10 %>% left_join(summary, by = c("TAXYR" = "TAX_YEAR",
                                                               "EIN" = "ORG_EIN"))

ceo_trans_10_fncl <- ceo_trans_10_fncl %>% left_join(revenue, by = c("TAXYR" = "TAX_YEAR",
                                                               "EIN" = "ORG_EIN"))

ceo_trans_10_fncl <- ceo_trans_10_fncl %>% left_join(expenses, by = c("TAXYR" = "TAX_YEAR",
                                                               "EIN" = "ORG_EIN"))

write.csv(ceo_trans_10_fncl, "CEO_trans_10EIN_fncl.csv" )


# summary2009 <- get_table( "F9-P01-T00-SUMMARY", year=2009 )
# summary2010 <- get_table( "F9-P01-T00-SUMMARY", year=2010 )
# summary2011 <- get_table( "F9-P01-T00-SUMMARY", year=2011 )
# summary2012 <- get_table( "F9-P01-T00-SUMMARY", year=2012 )
# summary2013 <- get_table( "F9-P01-T00-SUMMARY", year=2013 )
# summary2014 <- get_table( "F9-P01-T00-SUMMARY", year=2014 )
# summary2015 <- get_table( "F9-P01-T00-SUMMARY", year=2015 )
# summary2016 <- get_table( "F9-P01-T00-SUMMARY", year=2016 )
# summary2017 <- get_table( "F9-P01-T00-SUMMARY", year=2017 )
# summary2018 <- get_table( "F9-P01-T00-SUMMARY", year=2018 )
# summary2019 <- get_table( "F9-P01-T00-SUMMARY", year=2019 )
# 
# revenue2009 <- get_table( "F9-P08-T00-REVENUE", year=2009 )
# revenue2010 <- get_table( "F9-P08-T00-REVENUE", year=2010 )
# revenue2011 <- get_table( "F9-P08-T00-REVENUE", year=2011 )
# revenue2012 <- get_table( "F9-P08-T00-REVENUE", year=2012 )
# revenue2013 <- get_table( "F9-P08-T00-REVENUE", year=2013 )
# revenue2014 <- get_table( "F9-P08-T00-REVENUE", year=2014 )
# revenue2015 <- get_table( "F9-P08-T00-REVENUE", year=2015 )
# revenue2016 <- get_table( "F9-P08-T00-REVENUE", year=2016 )
# revenue2017 <- get_table( "F9-P08-T00-REVENUE", year=2017 )
# revenue2018 <- get_table( "F9-P08-T00-REVENUE", year=2018 )
# revenue2019 <- get_table( "F9-P08-T00-REVENUE", year=2019 )
# 
# 
# expenses2009 <- get_table( "F9-P09-T00-EXPENSES", year=2009 )
# expenses2010 <- get_table( "F9-P09-T00-EXPENSES", year=2010 )
# expenses2011 <- get_table( "F9-P09-T00-EXPENSES", year=2011 )
# expenses2012 <- get_table( "F9-P09-T00-EXPENSES", year=2012 )
# expenses2013 <- get_table( "F9-P09-T00-EXPENSES", year=2013 )
# expenses2014 <- get_table( "F9-P09-T00-EXPENSES", year=2014 )
# expenses2015 <- get_table( "F9-P09-T00-EXPENSES", year=2015 )
# expenses2016 <- get_table( "F9-P09-T00-EXPENSES", year=2016 )
# expenses2017 <- get_table( "F9-P09-T00-EXPENSES", year=2017 )
# expenses2018 <- get_table( "F9-P09-T00-EXPENSES", year=2018 )
# expenses2019 <- get_table( "F9-P09-T00-EXPENSES", year=2019 )
# 
# 
# #Let's put them all together
# summary <- rbind(as.data.frame(summary2009), as.data.frame(summary2010),as.data.frame(summary2011),
#                  as.data.frame(summary2012),as.data.frame(summary2013),as.data.frame(summary2014),
#                  as.data.frame(summary2015),as.data.frame(summary2016),as.data.frame(summary2017),
#                  as.data.frame(summary2018),as.data.frame(summary2019))
# 
# revenue <- rbind(as.data.frame(revenue2009),as.data.frame(revenue2010),as.data.frame(revenue2011),
#                  as.data.frame(revenue2012),as.data.frame(revenue2013),as.data.frame(revenue2014),
#                  as.data.frame(revenue2015),as.data.frame(revenue2016),as.data.frame(revenue2017),
#                  as.data.frame(revenue2018),as.data.frame(revenue2019))
# 
# expenses <- rbind(as.data.frame(expenses2009),as.data.frame(expenses2010),as.data.frame(expenses2011),
#                   as.data.frame(expenses2012),as.data.frame(expenses2013),as.data.frame(expenses2014),
#                   as.data.frame(expenses2015),as.data.frame(expenses2016),as.data.frame(expenses2017),
#                   as.data.frame(expenses2018),as.data.frame(expenses2019))
# 
# 
# 
# 
# #Orgs can return various versions of their tax forms each year
# #For now, we will keep only the first observation, true analysis will need to revisit this decision
# summary <- summary %>% group_by(ORG_EIN, TAX_YEAR) %>%
#   filter(row_number()==1)
# 
# revenue <- revenue %>% group_by(ORG_EIN, TAX_YEAR) %>%
#   filter(row_number()==1)
# 
# expenses <- expenses %>% group_by(ORG_EIN, TAX_YEAR) %>%
#   filter(row_number()==1)
# 
# 
# 
# #Saving environment space by removing the other dfs
# remove(summary2009, summary2010, summary2011, summary2012, summary2013, summary2014,
#      summary2015, summary2016, summary2017, summary2018, summary2019 )
# remove(expenses2009, expenses2010, expenses2011, expenses2012, expenses2013, expenses2014,
#      expenses2015, expenses2016, expenses2017, expenses2018, expenses2019 )
# remove(balance2009, balance2010, balance2011, balance2012, balance2013, balance2014,
#      balance2015, balance2016, balance2017, balance2018, balance2019 )
# #Let's join everything together
# 
# 
# ceo_trans_1000_fncl <- ceo_trans_1000 %>% left_join(summary, by = c("TAXYR" = "TAX_YEAR",
#                                                               "EIN" = "ORG_EIN"))
# 
# ceo_trans_1000_fncl <- ceo_trans_1000_fncl %>% left_join(expenses, by = c("TAXYR" = "TAX_YEAR",
#                                                                    "EIN" = "ORG_EIN"))
# 
# ceo_trans_1000_fncl <- ceo_trans_1000_fncl %>% left_join(revenue, by = c("TAXYR" = "TAX_YEAR",
#                                                                    "EIN" = "ORG_EIN"))
# 
# 
# write.csv(ceo_trans_1000_fncl, "toy_CEO_trans_1000EIN_fncl.csv")


```




#### Summary Statistics of Transitions

Now we're ready for some analyses! We are most interested in understanding transitions by their gendering. That is to say that we want to know if there are differences in observable firm dimensions for nonprofits that experience a CEO transition from male to male relative to the other permutations of male to female, female to male, and female to female. Let's start by looking at org differences by these transition types. We will use the 1000 EIN observations for this analysis. We have provided this dataset with the financial data attached (this was accomplished by running the commented lines above). For simplicity, we will only consider a few firm dimensions such as employee size and total assets.



```{r}

#This df 
ceo_trans_1000_fncl <- read.csv("toy_CEO_trans_1000EIN_fncl.csv")

#First need to denote transitions 
ceo_trans_1000_fncl <- ceo_trans_1000_fncl %>%
  arrange(EIN, transition_no, TAXYR)%>% #for each org, transition, and year, 
  group_by(EIN, transition_no) %>%       
  mutate(period = row_number())%>%       #let's denote which period the row is relative to (i.e., how many years before /after a transition)
  ungroup()

#Let's make this variable a bit more readable
ceo_trans_1000_fncl$period <- paste0("T", ceo_trans_1000_fncl$period-3)
ceo_trans_1000_fncl$period <- factor(ceo_trans_1000_fncl$period, levels = c("T-2", "T-1", "T0" , "T1", "T2"))


#Need to get transition type too
#We want to know if the transition is M>M, M>F, F>M, or F>M
#We will first create a string of the CEO gender throughout the 5 year period
#The we will create a column that keeps the first and last gender (this is the gender transition)
ceo_trans_1000_fncl<- ceo_trans_1000_fncl %>%
  group_by(EIN, transition_no)%>%
  mutate(trans_tot = str_c(unlist(strsplit(paste(gender, collapse = ""), "")), collapse = "")
  ) %>%
  mutate(
    trans_type = str_sub(trans_tot, 1, 1) %>%
      str_c(str_sub(trans_tot, nchar(trans_tot), nchar(trans_tot)))  # Combine 1st and last letter
    
  )

#We want this variable to be a factor
ceo_trans_1000_fncl$trans_type <- as.factor(ceo_trans_1000_fncl$trans_type)



#We're going to get firm attributes by transition type
#Let's consider the attributes at t-1
#We'll consider basic variables like number of employees, total assets, etc.

#Note that further data cleaning is necessary for final presentation due to NA values input into some of these columns. For now, we will just remove the nas and continue with our analysis

temp <- ceo_trans_1000_fncl %>% group_by(trans_type)%>%
  filter(period == "T-1") %>%
  summarize(count = n(),
    num_emp_av =mean(F9_01_ACT_GVRN_EMPL_TOT, na.rm = T),
            num_emp_sd = sd(F9_01_ACT_GVRN_EMPL_TOT, na.rm = T),
            num_vol_av = mean(F9_01_ACT_GVRN_VOL_TOT, na.rm = T),
            num_vol_sd = sd(F9_01_ACT_GVRN_VOL_TOT, na.rm = T),
            total_exp_av = mean(F9_01_EXP_TOT_PY, na.rm = T),
            total_exp_sd = sd(F9_01_EXP_TOT_PY, na.rm = T),
            total_assets_av = mean(F9_01_NAFB_ASSET_TOT_BOY, na.rm = T),
            total_assets_sd = sd(F9_01_NAFB_ASSET_TOT_BOY, na.rm = T))

temp


```
\
There are 349 transitions from male to male (MM) transitions, 253 male to female transitions (MF), 160 female to male transitions (FM), and 305 female to female transitions (FF) in our dataset. FF orgs have the smallest number of employees, on average while MF have the highest. It should be noted that the standard deviation for number of employees is pretty high, suggesting a wide range of nonprofits. MM nonprofits have the highest total expeness on average and the highest total assets. Again, the SDs are wide, suggesting large variation across observations. 






#### Financial Measures by Transitions

The Glass Cliff Phenomenon hypothesizes that women are chosen for positions of power when these positions are more precarious. One way to denote a precarious position is by the firm's financial performance; poor financial performance suggests more precariousness. We acknowledge that financial performance is comprised of several different dimensions and it is sometimes hard to arrive at clean conclusions about "poorly performing nonprofits." For demonstration purposes we will specifically focus on the financial performance metric of post-depreciation profitability margin (podpm). This is defined as an income measure that determines a firm's profitability after incorporating non-cash expenses. Higher values of this metric are generally desirable because the indicate that an org is not lost its revenue to expenses. We will use the package `fiscal` from the Open Data Collective to calculate our variable of interest. The default parameters of the respective functions are already built for the 990 naming conventions so usage is pretty straight forward!
\

```{r, message = F, warning = F}



#Make sure to run the code chunk about to ensure your df_long_fncl has all the necessary variables 

#site: https://github.com/Nonprofit-Open-Data-Collective/fiscal/tree/main/R
ceo_trans_1000_fncl <- get_podpm(ceo_trans_1000_fncl)



#Let's plot these measures
plot_temp <- ceo_trans_1000_fncl %>%
  group_by(trans_type, period)%>%
  summarize(median_podpm =median(podpm, na.rm = T))


ggplot(data = plot_temp, aes(x = period, y = median_podpm, group = trans_type, color = trans_type)) + 
  geom_line(linewidth = 1.5)+ 
  geom_text_repel(aes(label = round(median_podpm,3)), size = 5, nudge_x = -0.07, nudge_y = 0.001, segment.size = 0, segment.color = NA)+
  theme_bw( ) + 
#  theme(text = element_text(size = 24))+
  scale_x_discrete(labels = c("T-2", "T-1", "Transition", "T+1", "T+2"))+
  labs(color = "Transition") +
  xlab("Period")+
  ylab("Median Post-Depreciation Profitability Margin") +
  ggtitle("Median Post-Depreciation Profitability Margin by Transition Type") +
  geom_vline(xintercept = 3, linetype = "dashed")



################################################
#Now doing density plots of these respective vars
################################################

#Let's compare the MM density to MF density in the t-1 period for the vats

ceo_trans_1000_fncl_MM <- ceo_trans_1000_fncl %>% filter(trans_type == "MM" &
                                             period == "T-1")
ceo_trans_1000_fncl_MF <- ceo_trans_1000_fncl %>% filter(trans_type == "MF"&
                                             period == "T-1")


ggplot() + 
  geom_density(data = ceo_trans_1000_fncl_MM,  aes(x = podpm, fill = "lightblue"), alpha = 0.5) +
  geom_density(data = ceo_trans_1000_fncl_MF,  aes(x = podpm, fill = "pink"), alpha = 0.5) +
  xlim(-1,1)+
  theme_bw()+
#  theme(text = element_text(size = 24))+
  scale_fill_manual(name = "Transition", values = c('lightblue', 'pink'), labels = c("pink" = "MF" ,  "lightblue" = "MM") ) +
  xlab("Post-Depreciation Profitability Margin")+
  ylab("Density") +
  ggtitle("Density ofPost-Depreciation Profitability Margin by Transition at t-1") 
  

```


The glass cliff phenomenon suggest that financial precarious NPs (seen by a significant drop in their financials between T-2 and T-1) would more likely hire a female to the CEO position. We start by looking at the PODPM variable over the periods. MM organizations start with the highest median profitability margin but also experience the steepest drop between T-2 and T-1. We see a similar slope for FM organizations although the starting point is the lowest in the entire group. MF transitions do not appear to be preceded by steep changes in profitability. If the glass cliff hypothesis were true, we would expect the observed trajectory of FM but would not expect the other firms to have similar metrics around their transitions. This graph calls for further analysis on other financial measures to determine whether FM firms display a transition during significantly more precarious times than their counterparts. 

\
\
As a final understanding of the data, we look at the distribution of PODPM at T-1. We consider the two most relevant groups of MM and MF. We see that the distribution of financial variables tends to be extremely similar to both types of transitions, again failing to provide strong motivation for a glass cliff phenomenon.
\ 
\




